#pragma checksum "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "4e1a97901e54d9819ade8bdf16a4a4eef224681b"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace MyWaySO.Pages.Admin
{
    #line hidden
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using MyWaySO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using MyWaySO.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\_Imports.razor"
using Syncfusion.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using MyWaySO.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using MyWaySO.Areas.Identity.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using MyWaySO.Areas.Identity.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using System;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using System.Threading.Tasks;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using System.Collections.Generic;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using System.ComponentModel.DataAnnotations;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using Microsoft.EntityFrameworkCore;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using Microsoft.AspNetCore.Mvc;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using Microsoft.AspNetCore.Mvc.Rendering;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
using Syncfusion.Blazor.DropDowns;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/edituser/{id:guid}")]
    public partial class EditUser : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 133 "C:\Users\ruisa\source\repos\MyWaySO\MyWaySO\Pages\Admin\EditUser.razor"
       
    [Parameter]
    public Guid Id { get; set; }

    public ApplicationUserRole ApplicationUserRole { get; set; }
    [BindProperty]
    public ApplicationUser applicationUser { get; set; }
    public Guid SelectedRole { get; set; }

    public IList<Uh> AllUhs = new List<Uh>();

    //protected override async Task OnInitializedAsync()
    protected override void OnInitialized()
    {
        AllUhs = _uhService.GetAllUhs();

        if (Id != null)
        {
            applicationUser = applicationUserService.GetUser(Id.ToString());

            //ApplicationUser = db.ApplicationUsers
            //.Include(r => r.ApplicationUserRoles).ThenInclude(r => r.Role)
            //.Include(u => u.UserUhs).ThenInclude(u => u.Uh)
            //.AsNoTracking()
            //.FirstOrDefault(i => i.Id == Id.ToString());

            string roleId = db.ApplicationUserRoles.Where(i => i.UserId == Id.ToString()).Select(r => r.RoleId).FirstOrDefault();

            if (roleId != null)
            {
                SelectedRole = new Guid(roleId);
            }

            //ViewData["RoleNames"] = new SelectList(db.ApplicationRoles.OrderBy(n => n.Name), "Id", "Name", SelectedRole);

            //if (ApplicationUser == null)
            //{
            //    //return NotFound();
            //}

            //PopulateAssignedUhData(db, ApplicationUser);
        }
    }

    public List<AssignedUhData> AssignedUhDataList { get; set; }

    public void PopulateAssignedUhData(ApplicationDbContext db, ApplicationUser appUser)
    {
        if (appUser == null) { throw new NullReferenceException(); }
        if (db == null) { throw new NullReferenceException(); }

        DbSet<Uh> todasUh = db.Uhs;
        HashSet<Guid> userUhs = new HashSet<Guid>(appUser.UserUhs.Select(u => u.UhID));
        AssignedUhDataList = new List<AssignedUhData>();

        foreach (Uh uh in todasUh)
        {
            AssignedUhDataList.Add(new AssignedUhData
            {
                UhID = uh.UhID,
                Name = uh.UhNome,
                Assigned = userUhs.Contains(uh.UhID)
            });
        }
    }

    public void PopulateAllUhData(ApplicationDbContext db)
    {
        if (db == null) { throw new NullReferenceException(); }

        DbSet<Uh> todasUh = db.Uhs;
        AssignedUhDataList = new List<AssignedUhData>();

        foreach (Uh uh in todasUh)
        {
            AssignedUhDataList.Add(new AssignedUhData
            {
                UhID = uh.UhID,
                Name = uh.UhNome,
                Assigned = false
            });
        }
    }

    public static void UpdateUserUhs(ApplicationDbContext db, string[] selectedUhs, ApplicationUser userToUpdate)
    {
        if (userToUpdate == null) { throw new NullReferenceException(); }
        if (db == null) { throw new NullReferenceException(); }
        if (selectedUhs == null)
        {
            userToUpdate.UserUhs = new List<UserUh>();
            return;
        }

        HashSet<string> selectedUhsHS = new HashSet<string>(selectedUhs);
        HashSet<Guid> userUhs = new HashSet<Guid>(userToUpdate.UserUhs.Select(u => u.UhID));
        foreach (Uh uh in db.Uhs)
        {
            if (selectedUhsHS.Contains(uh.UhID.ToString()))
            {
                if (!userUhs.Contains(uh.UhID))
                {
                    userToUpdate.UserUhs.Add(
                        new UserUh
                        {
                            User = userToUpdate,
                            UhID = uh.UhID
                        });
                }
            }
            else
            {
                if (userUhs.Contains(uh.UhID))
                {
                    UserUh uhToRemove = userToUpdate.UserUhs.SingleOrDefault(i => i.UhID == uh.UhID);
                    _ = db.Remove(uhToRemove);
                }
            }
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IUhService _uhService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IAppUserService applicationUserService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ApplicationDbContext db { get; set; }
    }
}
#pragma warning restore 1591
